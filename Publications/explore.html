---
layout: page
title: Explore Topics
---

<div id="explore">
  <div id="graph"></div>
  <div id="details">
    <h3>Click a topic to see papers</h3>
    <p>You can also link here with <code>?tag=CFD</code> (or any topic).</p>
  </div>
</div>

<style>
/* Top (graph) / bottom (details) layout */
#explore {
  display: grid;
  grid-template-rows: minmax(380px, 52vh) auto; /* big graph area, then details */
  gap: 16px;
}

/* Graph panel */
#graph {
  border: 1px solid #eee;
  border-radius: 8px;
  background: rgba(0,0,0,0.02);
  overflow: hidden;
}

/* Details panel */
#details {
  padding: 8px 12px;
  border: 1px solid #eee;
  border-radius: 8px;
}
#details ul { margin: 0; padding-left: 18px; }

/* Links & nodes */
.link { stroke: #999; stroke-opacity: .36; }
.node { cursor: pointer; }
.node circle { transition: r 120ms ease, opacity 120ms ease; }

/* Badges */
.legend { display:flex; flex-wrap:wrap; gap:8px; margin-top:8px; }
.badge { display:inline-block; padding:3px 6px; border-radius:6px; font-size:12px; border:1px solid rgba(0,0,0,.1); }

@media (prefers-color-scheme: dark){
  #graph  { background: rgba(255,255,255,0.03); border-color: rgba(255,255,255,.12); }
  #details{ border-color: rgba(255,255,255,.12); }
  .link   { stroke: rgba(255,255,255,.6); }
}
</style>

<!-- D3 (CDN) -->
<script src="https://cdn.jsdelivr.net/npm/d3@7"></script>

<script>
(function(){
  const GRAPH_URL = "{{ '/assets/data/topic_graph.json' | relative_url }}";
  const PUBS_URL  = "{{ '/assets/data/pubs.json' | relative_url }}";

  const graphEl   = document.getElementById('graph');
  const detailsEl = document.getElementById('details');
  const qs        = new URLSearchParams(location.search);
  const startTag  = qs.get('tag');

  // ---------- Right (bottom) panel ----------
  function renderDetails(topic, pubs){
    if(!topic){
      detailsEl.innerHTML = '<h3>Click a topic to see papers</h3><p>You can also link here with <code>?tag=CFD</code> (or any topic).</p>';
      return;
    }
    const filtered = pubs.filter(p => (p.tags||[]).map(t=>t.toLowerCase()).includes(topic.toLowerCase()));
    const byYear = {};
    filtered.forEach(p => { (byYear[p.year || "—"] ||= []).push(p); });
    const years = Object.keys(byYear).sort((a,b)=> (b==='—')? -1 : (+b - +a));

    let html = `<h3>${topic}</h3><div class="legend"><span class="badge">Papers: ${filtered.length}</span></div><ul>`;
    years.forEach(y=>{
      byYear[y].sort((a,b)=> a.title.localeCompare(b.title));
      byYear[y].forEach(p=>{
        const venue = p.venue ? `, <em>${p.venue}</em>` : '';
        const yearTxt = p.year ? `, ${p.year}` : '';
        const link = p.url ? ` <a href="${p.url}" target="_blank" rel="noopener">[Link]</a>` : '';
        html += `<li>${p.title}${venue}${yearTxt}${link}</li>`;
      });
    });
    html += '</ul>';
    detailsEl.innerHTML = html;
  }

  // ---------- Graph ----------
  function drawGraph(data, pubs){
    if(!data || !data.nodes || data.nodes.length === 0){
      graphEl.innerHTML = '<div style="padding:12px;">No topics found. Add tags to your papers in <code>_data/pub_tags.yml</code> or BibTeX <code>keywords</code>.</div>';
      return;
    }

    const width  = graphEl.clientWidth;
    const height = graphEl.clientHeight || 420;

    const svg = d3.select(graphEl).append('svg')
      .attr('width', '100%')
      .attr('height', '100%')
      .attr('viewBox', [0,0,width,height])
      .attr('preserveAspectRatio', 'xMidYMid meet');

    // Group for zoom/pan and fitting
    const g = svg.append('g').attr('class', 'viz');

    // Compute degree (weighted by link weight) for color mapping
    const degree = new Map();
    data.nodes.forEach(n => degree.set(n.id, 0));
    data.links.forEach(l => {
      const w = l.weight || 1;
      const s = l.source.id || l.source, t = l.target.id || l.target;
      degree.set(s, (degree.get(s)||0) + w);
      degree.set(t, (degree.get(t)||0) + w);
    });
    const degVals = Array.from(degree.values());
    const ext = d3.extent(degVals);
    // Avoid NaN when all degrees equal
    const degScale = (ext[0] === ext[1])
      ? (v => 0.6) // constant mid tone
      : d3.scaleLinear().domain(ext).range([0.15, 0.9]); // nice mid-range

    // Teal gradient (robust): cubehelix from very light aqua -> deep teal
    const cStart = d3.hsl(185, 0.25, 0.90); // light
    const cEnd   = d3.hsl(190, 0.85, 0.35); // deep teal
    const tealInterp = d3.interpolateCubehelix(cStart, cEnd);
    const color = (id) => tealInterp(degScale(degree.get(id) || 0));

    const linkWidth = d3.scaleLinear()
      .domain(d3.extent(data.links, d => d.weight || 1))
      .range([1.2, 5]);

    const sim = d3.forceSimulation(data.nodes)
      .force('link', d3.forceLink(data.links).id(d => d.id).distance(d => 70).strength(0.25))
      .force('charge', d3.forceManyBody().strength(-180))
      .force('center', d3.forceCenter(width/2, height/2))
      .force('x', d3.forceX(width/2).strength(0.05))
      .force('y', d3.forceY(height/2).strength(0.05))
      .force('collision', d3.forceCollide().radius(22));

    const link = g.append('g')
      .attr('stroke-linecap','round')
      .selectAll('line')
      .data(data.links)
      .join('line')
      .attr('class','link')
      .attr('stroke-width', d => linkWidth(d.weight||1));

    const node = g.append('g')
      .selectAll('g')
      .data(data.nodes)
      .join('g')
      .attr('class','node');

    node.append('circle')
      .attr('r', 10)
      .attr('fill', d => color(d.id))
      .attr('stroke', window.matchMedia('(prefers-color-scheme: dark)').matches ? 'rgba(255,255,255,.35)' : 'rgba(0,0,0,.25)')
      .attr('stroke-width', 0.6)
      .on('mouseenter', (_, d) => highlight(d))
      .on('mouseleave', clearHighlight)
      .on('click', (_, d) => selectTopic(d.id));

    node.append('text')
      .text(d => d.id)
      .attr('x', 12)
      .attr('y', 4)
      .attr('font-size', 12)
      .attr('fill', 'currentColor')
      .attr('pointer-events', 'none')
      .style('user-select', 'none');

    sim.on('tick', () => {
      link
        .attr('x1', d => d.source.x)
        .attr('y1', d => d.source.y)
        .attr('x2', d => d.target.x)
        .attr('y2', d => d.target.y);
      node.attr('transform', d => `translate(${d.x},${d.y})`);
    });

    // Zoom/pan + auto-fit
    const zoom = d3.zoom().scaleExtent([0.6, 4]).o
